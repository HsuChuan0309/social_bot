<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chatbot å…¨è¢å¹•ï¼ˆ5 æ¬¡äº’å‹•å¾Œè§£é– / å¼·åŒ–ç‰ˆï¼‰</title>
  <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #ffffff;
    }
    df-messenger {
      --df-messenger-chat-window-width: 100vw;
      --df-messenger-chat-window-height: 100vh;
      --df-messenger-chat-background-color: white;
      --df-messenger-bot-message: #f1f1f1;
      --df-messenger-user-message: #cfe9ff;
      --df-messenger-font-color: black;
      position: fixed;
      inset: 0;
    }
    .hint {
      position: fixed;
      top: 10px;
      left: 12px;
      font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Noto Sans, Arial, "Noto Sans TC", "PingFang TC", "Heiti TC", "Microsoft JhengHei", sans-serif;
      font-size: 14px;
      color: #666;
      z-index: 1;
      background: rgba(255,255,255,0.7);
      padding: 6px 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="hint">ğŸŒŸ è«‹è‡³å°‘è¼¸å…¥ 5 æ¬¡è¨Šæ¯ï¼Œé”æˆå¾Œæœƒè‡ªå‹•è§£é–ä¸‹ä¸€é </div>

  <df-messenger
    intent="WELCOME"
    chat-title="0806"
    agent-id="236034eb-ea4a-47e7-b0c8-202f144d704e"
    language-code="zh-tw"
    expand="true">
  </df-messenger>

  <script>
    let userTurnCount = 0;
    const REQUIRED_TURNS = 5;
    let unlocked = false;

    function unlockIfReady() {
      if (!unlocked && userTurnCount >= REQUIRED_TURNS) {
        unlocked = true;
        const msg = "show-next-button";
        // é€šçŸ¥çˆ¶èˆ‡æœ€ä¸Šå±¤ï¼ˆæœ‰äº›å¹³å°çš„ iframe å·¢ç‹€çµæ§‹ä¸åŒï¼‰
        try { window.parent.postMessage(msg, "*"); } catch (e) {}
        try { window.top.postMessage(msg, "*"); } catch (e) {}
        const hint = document.querySelector(".hint");
        if (hint) hint.textContent = "âœ… æ¢ä»¶é”æˆï¼Œå¯ä»¥é€²å…¥ä¸‹ä¸€é ";
      }
    }

    // 1) ä½¿ç”¨è€…æŒ‰ä¸‹é€å‡ºæ™‚ï¼ˆå®˜æ–¹äº‹ä»¶åç¨±ï¼‰
    window.addEventListener("message", (event) => {
      const data = event.data || {};
      if (data.eventType === "dfUserInputEntered") {
        // data.queryInput?.text?.text
        const t = data.queryInput && data.queryInput.text && data.queryInput.text.text;
        if (t && t.trim().length > 0) {
          userTurnCount += 1;
          unlockIfReady();
        }
      }
    });

    // 2) å‚™æ´ï¼šåœ¨æ”¶åˆ° dfResponse æ™‚ï¼Œä¹Ÿå¾ queryInput åˆ¤æ–·æ˜¯å¦ç‚ºä½¿ç”¨è€…æ–‡å­—
    window.addEventListener("message", (event) => {
      const data = event.data || {};
      if (data.eventType === "dfResponse") {
        const t = data.queryInput && data.queryInput.text && data.queryInput.text.text;
        if (t && t.trim().length > 0) {
          userTurnCount += 1;
          unlockIfReady();
        }
      }
    });

    // 3) æœ€å¾Œå‚™æ´ï¼šè¶…éä¸€å®šæ™‚é–“æˆ–åµæ¸¬åˆ° 10 å‰‡è¨Šæ¯æ™‚ï¼Œä»æœªè§£é–å°±ä¸»å‹•æ”¾è¡Œï¼ˆé¿å…å—è©¦è€…è¢«å¡ä½ï¼‰
    setTimeout(() => {
      if (!unlocked) {
        try { window.parent.postMessage("show-next-button", "*"); } catch (e) {}
        try { window.top.postMessage("show-next-button", "*"); } catch (e) {}
        const hint = document.querySelector(".hint");
        if (hint) hint.textContent = "âš ï¸ æ™‚é–“åˆ°ï¼Œè‡ªå‹•å…è¨±ç¹¼çºŒ";
      }
    }, 10 * 60 * 1000); // 10 åˆ†é˜ä¿éšªæ©Ÿåˆ¶
  </script>
</body>
</html>
