<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chatbot å…¨è¢å¹•ï¼ˆ5 æ¬¡äº’å‹•å¾Œè§£é–ï¼‰</title>
  <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #ffffff;
    }
    /* è®“èŠå¤©çª—å¡«æ»¿æ•´å€‹ç•«é¢ */
    df-messenger {
      --df-messenger-chat-window-width: 100vw;
      --df-messenger-chat-window-height: 100vh;
      --df-messenger-chat-background-color: white;
      --df-messenger-bot-message: #f1f1f1;
      --df-messenger-user-message: #cfe9ff;
      --df-messenger-font-color: black;
      position: fixed;
      inset: 0;
    }
    .hint {
      position: fixed;
      top: 10px;
      left: 12px;
      font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Noto Sans, Arial, "Noto Sans TC", "PingFang TC", "Heiti TC", "Microsoft JhengHei", sans-serif;
      font-size: 14px;
      color: #666;
      z-index: 1;
      background: rgba(255,255,255,0.7);
      padding: 6px 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="hint">ğŸŒŸ è«‹è‡³å°‘è¼¸å…¥ 5 æ¬¡è¨Šæ¯ï¼Œé”æˆå¾Œæœƒè‡ªå‹•è§£é–ä¸‹ä¸€é </div>

  <df-messenger
    intent="WELCOME"
    chat-title="0806"
    agent-id="236034eb-ea4a-47e7-b0c8-202f144d704e"
    language-code="zh-tw"
    expand="true">
  </df-messenger>

  <script>
    // è¨ˆç®—ã€Œä½¿ç”¨è€…ç™¼é€æ–‡å­—ã€çš„æ¬¡æ•¸ â€”â€” é”åˆ° 5 æ¬¡å°±é€šçŸ¥çˆ¶é é¢
    let userTurnCount = 0;
    const REQUIRED_TURNS = 5;
    let unlocked = false;

    window.addEventListener("message", (event) => {
      const data = event.data || {};

      // Dialogflow Messenger è¼‰å…¥äº‹ä»¶
      if (data.eventType === "dfMessengerLoaded") {
        console.log("ğŸ’¬ Chatbot å·²è¼‰å…¥");
      }

      // æ”¶åˆ°ä¸€æ¬¡ agent çš„å›æ‡‰äº‹ä»¶ï¼›è£¡é¢åŒæ™‚æœƒå¸¶ä¸Šç•¶æ¬¡ request çš„ queryInput
      if (data.eventType === "dfResponse") {
        // åƒ…ç•¶ä½¿ç”¨è€…æœ‰è¼¸å…¥ç´”æ–‡å­—æ™‚æ‰è¨ˆæ•¸
        if (data.queryInput && data.queryInput.text && data.queryInput.text.text) {
          userTurnCount += 1;
          console.log("ä½¿ç”¨è€…è¼¸å…¥æ¬¡æ•¸:", userTurnCount);

          if (!unlocked && userTurnCount >= REQUIRED_TURNS) {
            unlocked = true;
            // é€šçŸ¥çˆ¶é é¢ï¼ˆQualtricsï¼‰å¯ä»¥é¡¯ç¤ºä¸‹ä¸€é æŒ‰éˆ•
            window.parent.postMessage("show-next-button", "*");
            console.log("âœ… å·²é”åˆ° 5 æ¬¡ï¼Œå·²é€šçŸ¥çˆ¶é é¢é¡¯ç¤ºä¸‹ä¸€é æŒ‰éˆ•");
            // é¡¯ç¤ºå®Œæˆæç¤º
            const hint = document.querySelector(".hint");
            if (hint) hint.textContent = "âœ… æ¢ä»¶é”æˆï¼Œå¯ä»¥é€²å…¥ä¸‹ä¸€é ";
          }
        }
      }
    });
  </script>
</body>
</html>
